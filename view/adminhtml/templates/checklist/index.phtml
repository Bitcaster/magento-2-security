<?php
$unSecureNames = $block->checkAdminUserName();
?>
<div class="box box-<?php echo empty($unSecureNames) ? 'green' : 'red'; ?>">
    <div class="box-header with-border">
        <strong><?php echo __("Check admin's username:"); ?></strong>
    </div>
    <div class="notice">
        <p><?php echo __("The follow usernames is not secured: "); ?> admin, root, test, magento.
            <?php echo __(" Hackers can guest username easily. Click on an user to change username."); ?></p>
    </div>
    <div class="err-nof">
        <?php if (!empty($unSecureNames)): ?>
            <?php foreach ($unSecureNames as $unSecureName): ?>
                <div class="err-nof-line">
                    <i class="fa fa-remove"></i>
                    <span>Username:" <?php echo $unSecureName['username']; ?>" is not secure.   </span>
                    <a class="fix-it">Fix it</a>
                </div>

            <?php endforeach; ?>
        <?php else: ?>
            <i class="fa fa-check"></i>
            <span>There is no common user in your store.</span>
        <?php endif; ?>
    </div>
</div>
<div class="box box-<?php echo (!$block->checkFrontendCaptcha() && !$block->checkBackendCaptcha()) ? 'red' : 'green'; ?>">
    <div class="box-header with-border">
        <strong><?php echo __("Check captcha:"); ?></strong>
    </div>
    <div class="err-nof">
        <?php if (!$block->checkFrontendCaptcha()): ?>
            <i class="fa fa-remove"></i>
            <span><?php echo __("Frontend captcha is not enabled. 
            Hackers may carry out brute-force attacks on your customers' accounts"); ?></span>
            <a class="fix-it">Fix it</a>
        <?php else: ?>
            <p><?php echo __("Frontend captcha is enabled."); ?></p>
        <?php endif; ?>
        <?php if (!$block->checkBackendCaptcha()): ?>
            <br/>
            <div class="err-nof-line">
                <i class="fa fa-remove"></i>
                <span><?php echo __("Backend captcha is not enabled. 
                To protect your backend from brute-force attacks, you should enable it."); ?></span>
                <a class="fix-it">Fix it</a>
            </div>
        <?php else: ?>
            <p><?php echo __("Backend captcha is enabled."); ?></p>
        <?php endif; ?>
    </div>
</div>
<?php
$version = $block->checkLatestVersion();
$isLatest = $version['lastestVer'] == $version['currentVersion'];
?>
<div class="box box-<?php echo $isLatest ? 'green' : 'red'; ?>">
    <div class="box-header with-border">
        <strong><?php echo __("Check Magento Version:"); ?></strong>
    </div>
    <div class="err-nof">
        <?php if (!$isLatest) : ?>
            <div class="err-nof-line">
                <i class="fa fa-remove"></i>
                <span>
                    <?php
                    echo __("Your Magento version is : ").$version['currentVersion'].__(", the latest version is : ").$version['lastestVer'];
                    ?>
                    <a class="fix-it">Upgrade</a>
                    </span>
            </div>
        <?php else: ?>
            <p><?php echo __("Your store is running on the latest version."); ?></p>
        <?php endif; ?>
    </div>
</div>
<?php $dbPrefix = $block->getDatabasePrefix() ?>
<div class="box box-<?php echo $dbPrefix ? 'green' : 'red'; ?>">
    <div class="box-header with-border">
        <strong><?php echo __("Check database prefix:"); ?></strong>
    </div>
    <div class="err-nof">
        <?php if ($dbPrefix): ?>
            <i class="fa fa-check"></i>
            <span><?php echo __("Your store's database is good."); ?></span>
        <?php else: ?>
            <div class="err-nof-line">
                <i class="fa fa-remove"></i>
                <span><?php echo __("Your store's database hasn't table prefix."); ?><a class="fix-it"> Fix it</a></span>
            </div>
        <?php endif; ?>
    </div>
</div>

<script>
    require([
        'jquery'
    ], function ($) {
        $('.fix-it').each(function () {
            $(this).click(function () {
                if (!$(this).parent().find('.notification').length) {
                    $(this).parent().append('<div class="notification"><?php echo __("Please update to Security Pro edition to resolve this issue automatically."); ?></div>');
                    $('body').click(function (e) {
                        if (!$(e.target).closest('.notification').length && !$(e.target).closest('.fix-it').length) {
                            $('.notification').remove();
                        }
                    });
                }
            });
        });
    });
</script>
<style>
    .box {
        position: relative;
        border-radius: 3px;
        background: #ffffff;
        border: 1px solid #ddd;
        border-top: 3px solid #d2d6de;
        margin-bottom: 20px;
        width: 70%;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
    }

    .box.box-green {
        border-top-color: #00a65a;
    }

    .box.box-yellow {
        border-top-color: yellow;
    }

    .box.box-red {
        border-top-color: red;
    }

    .fa-remove {
        color: red;
    }

    .fa-check {
        color: green;
    }

    .box-header.with-border {
        border-bottom: 1px solid #f4f4f4;
    }

    .box-header {
        color: #444;
        display: block;
        padding: 10px;
        position: relative;
    }

    .notice {
        margin-left: 20px;
    }

    .err-nof {
        margin: 20px;
    }

    .notification {
        background-color: #fefbbb;
        margin: 20px;
        padding: 10px;
    }
</style>