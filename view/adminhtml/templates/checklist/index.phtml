<?php
$unSercureNames = $block->checkAdminUserName();
?>
<div class="box box-<?php echo empty($unSercureNames) ? 'green' : 'red'; ?>">
    <div class="box-header with-border">
        <strong>Check admin username:</strong>
    </div>
    <div class="notice">
        <p>The follow username(s) is not secured: admin, root, test, magento. Hackers can guest username easily. Click
            on an
            user to change username.</p>
    </div>
    <div class="err-nof">
        <?php
        if (!empty($unSercureNames)):
            ?>

            <?php foreach ($unSercureNames as $unSercureName): ?>
            <div class="err-nof-line">
                <i class="fa fa-remove"></i>
                <span>User name:" <?php echo $unSercureName['username']; ?>" is not sercure   </span>
                <a class="fix-it">fix it</a>
            </div>

        <?php endforeach; ?>
        <?php else: ?>
            <i class="fa fa-check"></i>
            <p>There is no common user in your store.</p>
        <?php endif; ?>
    </div>
</div>
<div class="box box-<?php echo (!$block->checkFrontendCaptcha() && !$block->checkBackendCaptcha()) ? 'red' : 'green'; ?>">
    <div class="box-header with-border">
        <strong>Check captcha:</strong>
    </div>
    <div class="err-nof">
        <?php if (!$block->checkFrontendCaptcha()): ?>
            <i class="fa fa-remove"></i>
            <span>Frontend captcha is not enabled.Hackers can brute force attack your customer accounts.</span>
            <a class="fix-it">fix it</a>
        <?php else: ?>
            <p>Frontend captcha is enabled.</p>
        <?php endif; ?>
        <?php if (!$block->checkBackendCaptcha()): ?>
            <br/>
            <div class="err-nof-line">

                <i class="fa fa-remove"></i>
                <span>Backend captcha is not enabled.To protect brute force attack, you should enable it.</span>
                <a class="fix-it">fix it</a>
            </div>
        <?php else: ?>
            <p>Backend captcha is enabled.</p>
        <?php endif; ?>
    </div>
</div>
<div class="box box-<?php echo empty($unSercureNames) ? 'green' : 'red'; ?>">
    <div class="box-header with-border">
        <strong>Check Magento Version:</strong>
    </div>

    <?php $version = $block->checkLatestVersion(); ?>
    <div class="err-nof">
        <p>Your version is: <?php echo $version['currentVersion']; ?></p>
        <?php foreach ($version['lastestVer'] as $key => $ver): ?>
            <div class="err-nof-line">

                <p>The latest version of <?php echo $key; ?> is: <?php echo $ver; ?>
                    <a class="fix-it">update</a>
                </p>
            </div>
        <?php endforeach; ?>
    </div>
</div>

<?php $dbPrefix = $block->getDatabasePrefix() ?>
<div class="box box-<?php echo $dbPrefix ? 'green' : 'red'; ?>">
    <div class="box-header with-border">
        <strong>Check database prefix:</strong>
    </div>
    <div class="err-nof">

        <?php if ($dbPrefix): ?>
            <i class="fa fa-check"></i>
            <span>Your store's database is good.</span>
        <?php else: ?>
            <div class="err-nof-line">
                <i class="fa fa-remove"></i>
                <span>Your store's database hasn't table prefix. <a class="fix-it">fix it</a></span>
            </div>
        <?php endif; ?>
    </div>
</div>

<script>
    require([
        'jquery'
    ], function ($) {
        $('.fix-it').each(function () {
            $(this).click(function () {
                // alert('please update to Pro version to know more detail');
                $(this).parent().append('<div class="notification">Please update to Pro version to know more detail</div>');
                $('body').click(function (e) {
                    if (!$(e.target).closest('.notification').length && !$(e.target).closest('.fix-it').length) {
                        $('.notification').remove();
                    }
                });
            });
        });
    });
</script>
<style>
    .box {
        position: relative;
        border-radius: 3px;
        background: #ffffff;
        border: 1px solid #ddd;
        border-top: 3px solid #d2d6de;
        margin-bottom: 20px;
        width: 70%;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
    }

    .box.box-green {
        border-top-color: #00a65a;
    }

    .box.box-yellow {
        border-top-color: yellow;
    }

    .box.box-red {
        border-top-color: red;
    }

    .fa-remove {
        color: red;
    }

    .fa-check {
        color: green;
    }

    .box-header.with-border {
        border-bottom: 1px solid #f4f4f4;
    }

    .box-header {
        color: #444;
        display: block;
        padding: 10px;
        position: relative;
    }

    .notice {
        margin-left: 20px;
    }

    .err-nof {
        margin: 20px;
    }

    .notification {
        background-color: #fefbbb;
        margin: 20px;
        padding: 10px;
    }
</style>